<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>activetile.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Tily.ActiveTile.html">ActiveTile</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTile.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTile.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTile.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeLayer">removeLayer</a></li></ul></li><li><a href="Tily.ActiveTileBase.html">ActiveTileBase</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileBase.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeLayer">removeLayer</a></li></ul></li><li><a href="Tily.ActiveTileLayer.html">ActiveTileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateText">animateText</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeLayer">removeLayer</a></li></ul></li><li><a href="Tily.Animation.html">Animation</a><ul class='methods'><li data-type='method'><a href="Tily.Animation.html#update">update</a></li></ul></li><li><a href="Tily.Buffer.html">Buffer</a><ul class='methods'><li data-type='method'><a href="Tily.Buffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Buffer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Buffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.Buffer.html#getData">getData</a></li><li data-type='method'><a href="Tily.Buffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.Buffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.Buffer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.Buffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Buffer.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#resize">resize</a></li><li data-type='method'><a href="Tily.Buffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.Buffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.Buffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.Buffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferBase.html">BufferBase</a><ul class='methods'><li data-type='method'><a href="Tily.BufferBase.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.BufferBase.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.BufferBase.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.BufferBase.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferTransition.html">BufferTransition</a><ul class='methods'><li data-type='method'><a href="Tily.BufferTransition.html#update">update</a></li></ul></li><li><a href="Tily.Cell.html">Cell</a><ul class='methods'><li data-type='method'><a href="Tily.Cell.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Cell.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Cell.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Cell.html#draw">draw</a></li><li data-type='method'><a href="Tily.Cell.html#getData">getData</a></li><li data-type='method'><a href="Tily.Cell.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Cell.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Cell.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Cell.html#serialize">serialize</a></li></ul></li><li><a href="Tily.CellBuffer.html">CellBuffer</a><ul class='methods'><li data-type='method'><a href="Tily.CellBuffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.CellBuffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.CellBuffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.CellBuffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.ForegroundAnimation.html">ForegroundAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ForegroundAnimation.html#update">update</a></li></ul></li><li><a href="Tily.Main.html">Main</a><ul class='methods'><li data-type='method'><a href="Tily.Main.html#activateBuffer">activateBuffer</a></li><li data-type='method'><a href="Tily.Main.html#draw">draw</a></li></ul></li><li><a href="Tily.OffsetAnimation.html">OffsetAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetAnimation.html#update">update</a></li></ul></li><li><a href="Tily.OffsetTransition.html">OffsetTransition</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetTransition.html#update">update</a></li></ul></li><li><a href="Tily.OpacityAnimation.html">OpacityAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OpacityAnimation.html#update">update</a></li></ul></li><li><a href="Tily.RotationAnimation.html">RotationAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.RotationAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleAnimation.html">ScaleAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleTransition.html">ScaleTransition</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleTransition.html#update">update</a></li></ul></li><li><a href="Tily.TextAnimation.html">TextAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.TextAnimation.html#update">update</a></li></ul></li><li><a href="Tily.TileLayer.html">TileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.TileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.TileLayer.html#clear">clear</a></li><li data-type='method'><a href="Tily.TileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.TileLayer.html#fill">fill</a></li><li data-type='method'><a href="Tily.TileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.TileLayer.html#getTile">getTile</a></li><li data-type='method'><a href="Tily.TileLayer.html#resize">resize</a></li><li data-type='method'><a href="Tily.TileLayer.html#setTile">setTile</a></li></ul></li><li><a href="Tily.Transition.html">Transition</a><ul class='methods'><li data-type='method'><a href="Tily.Transition.html#update">update</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Tily.html">Tily</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">activetile.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>Tily.ActiveTile = (function(_super) {
	"use strict";
	__extends(ActiveTile, _super);
	
	/**
	 * A tile that can be translated, scaled, rotated and animated.
	 * @class
	 * @extends Tily.ActiveTileBase
	 * @memberof Tily
	 * @param {Number} [x=0] The initial x-coordinate of this active tile.
	 * @param {Number} [y=0] The initial y-coordinate of this active tile.
	 * @param {Number} [zIndex=0] The initial z-index of this active tile.
	 */
	function ActiveTile(x, y, zIndex) {
		_super.call(this);
		
		/**
		 * The position of this active tile.
		 * @type {vec2}
		 */
		this.position = vec2(x || 0, y || 0);
		
		/**
		 * The layer ordering of this active tile.
		 * @type {Number}
		 */
		this.zIndex = zIndex || 0;
		
		/**
		 * True if this active tile should clip at the tile edges.
		 * @default false
		 * @type {Boolean}
		 */
		this.clip = false;
		
		/**
		 * True if this active tile should wrap around tile edges.
		 * @default false
		 * @type {Boolean}
		 */
		this.wrap = false;
		
		/**
		 * True if this active tile should be flipped along the x-axis.
		 * @default false
		 * @type {Boolean}
		 */
		this.flip = false;
		
		/**
		 * The font to use when rendering this active tile's layers.
		 * @default "sans-serif"
		 * @type {String}
		 */
		this.font = "sans-serif";
		
		/**
		 * The foreground colour, used for rendering text on this active tile's layers.
		 * @default "white"
		 * @type {String}
		 */
		this.foreground = "white";
		
		/**
		 * The opacity of this active tile.
		 * @default 1
		 * @type {Number}
		 */
		this.opacity = 1;
		
		/**
		 * An offset from this active tile's position measured in tiles.
		 * @default { x: 0, y: 0 }
		 * @type {vec2}
		 */
		this.offset = vec2();
		
		/**
		 * The scale of this active tile.
		 * @default { x: 1, y: 1 }
		 * @type {vec2}
		 */
		this.scale = vec2(1, 1);
		
		/**
		 * The rotation angle of this active tile measured in radians.
		 * @default 0
		 * @type {Number}
		 */
		this.rotation = 0;
		
		/**
		 * True if this active tile should be removed in the next frame.
		 * @default false
		 * @type {Boolean}
		 */
		this.destroyed = false;
	}
	
	/**
	 * Add an active tile layer to this active tile at the specified z-index. If the z-index is
	 * undefined, add the layer on top of existing layers, and if the z-index is -1, add the layer
	 * below existing layers.
	 * @name addLayer
	 * @function
	 * @instance
	 * @memberof Tily.ActiveTile
	 * @param {Tily.ActiveTileLayer} layer The layer to add.
	 * @param {Number} [z] The z-index at which to add the layer. If this is -1, the layer will be
	 * added below existing layers and if it is undefined the layer will be added above existing
	 * layers.
	 */
	ActiveTile.prototype.addLayer = function(layer, z) {
		// Make sure the layer has a reference to the top-level active tile
		layer.activeTile = this;
		
		// Make sure the layer has a reference to its parent (ie. this active tile)
		layer.parent = this;
		_super.prototype.addLayer.call(this, layer, z);
	};
	
	/**
	 * Draw layers onto the specified context.
	 * @param {Tily.ActiveTileLayer[]} layers The layers to draw.
	 * @param {CanvasRenderingContext2D} context The context to draw this active tile onto.
	 * @param {Number} elapsedTime The time elapsed in seconds since the last draw call.
	 * @param {Number} tileSize The tile size measured in pixels.
	 */
	function drawLayers(layers, context, elapsedTime, tileSize) {
		for (let i = 0, length = layers.length; i &lt; length; i++) {
			layers[i].draw(context, elapsedTime, tileSize);
		}
	}
	
	/**
	 * Render this active tile onto the container context.
	 * @name draw
	 * @function
	 * @instance
	 * @memberof Tily.ActiveTile
	 * @param {CanvasRenderingContext2D} context The context to draw this active tile onto.
	 * @param {Number} elapsedTime The time elapsed in seconds since the last draw call.
	 * @param {Number} tileSize The tile size measured in pixels.
	 */
	ActiveTile.prototype.draw = function(context, elapsedTime, tileSize) {
		if (!this.layers) { return; }	// Active tile has no layers so don't render
		_super.prototype.draw.call(this, elapsedTime);
		context.save();
		context.font = (tileSize + 1) + "px " + this.font;
		context.fillStyle = this.foreground;
		context.globalAlpha = this.opacity;
		context.translate(this.position.x * tileSize - 0.5, this.position.y * tileSize - 0.5);
		
		// Clip tile boundaries if clipping is enabled
		if (this.clip) {
			context.rect(0, 0, tileSize + 1, tileSize + 1);
			context.clip();
		}
		context.translate((this.offset.x + 0.5) * tileSize, (this.offset.y + 0.5) * tileSize);
		context.rotate(this.rotation);
		context.scale(this.scale.x * (this.flip ? -1 : 1), this.scale.y);
		drawLayers(this.layers, context, elapsedTime, tileSize);
		
		// If both clipping and wrapping are enabled, re-draw the layers at inverted offsets
		if (this.clip &amp;&amp; this.wrap) {
			const wrapX = tileSize * (this.offset.x > 0 ? -1 : 1) * (this.flip ? -1 : 1),
				wrapY = tileSize * (this.offset.y > 0 ? -1 : 1);
			if (this.offset.x != 0) {
				context.save();
				context.translate(this.offset.x + wrapX, 0);
				drawLayers(this.layers, context, elapsedTime, tileSize);
				context.restore();
			}
			if (this.offset.y != 0) {
				context.save();
				context.translate(0, this.offset.y + wrapY, 0);
				drawLayers(this.layers, context, elapsedTime, tileSize);
				context.restore();
			}
			if (this.offset.x != 0 &amp;&amp; this.offset.y != 0) {
				context.save();
				context.translate(this.offset.x + wrapX, this.offset.y + wrapY);
				drawLayers(this.layers, context, elapsedTime, tileSize);
				context.restore();
			}
		}
		context.restore();
	};
	
	/**
	 * Get serializable data for this active tile.
	 * @name getData
	 * @function
	 * @instance
	 * @memberof Tily.ActiveTile
	 * @returns {Object} This active tile's data.
	 */
	ActiveTile.prototype.getData = function() {
		return {
			layers: this.layers.map(i => i.getData()),
			position: this.position,
			zIndex: this.zIndex,
			clip: this.clip,
			wrap: this.wrap,
			flip: this.flip,
			font: this.font,
			foreground: this.foreground,
			opacity: this.opacity,
			offset: this.offset,
			scale: this.scale,
			rotation: this.rotation
		};
	};
	
	/**
	 * Create an active tile from data.
	 * @name fromData
	 * @function
	 * @static
	 * @memberof Tily.ActiveTile
	 * @param {Object} data Serialized active tile data.
	 * @returns {Tily.ActiveTile} An active tile created from the provided data.
	 */
	ActiveTile.fromData = function(data) {
		const tile = new Tily.ActiveTile(data.position.x, data.position.y, data.zIndex);
		tile.layers = data.layers.map(i => Tily.ActiveTileLayer.fromData(tile, tile, i));
		tile.clip = data.clip;
		tile.wrap = data.wrap;
		tile.flip = data.flip;
		tile.font = data.font;
		tile.foreground = data.foreground;
		tile.opacity = data.opacity;
		tile.offset = data.offset;
		tile.scale = data.scale;
		tile.rotation = data.rotation;
		return tile;
	};
	return ActiveTile;
}(Tily.ActiveTileBase));</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Jan 27 2017 14:41:37 GMT+0000 (GMT Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
