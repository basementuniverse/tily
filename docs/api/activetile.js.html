<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>activetile.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="nav">
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-tily-reference.html">Quick Reference</a></li></ul><h3>Namespaces</h3><ul><li><a href="Tily.html">Tily</a></li></ul><h3>Classes</h3><ul><li><a href="Tily.ActiveTile.html">ActiveTile</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTile.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTile.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTile.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#move">move</a></li><li data-type='method'><a href="Tily.ActiveTile.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.ActiveTileBase.html">ActiveTileBase</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileBase.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.ActiveTileLayer.html">ActiveTileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateText">animateText</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.Animation.html">Animation</a><ul class='methods'><li data-type='method'><a href="Tily.Animation.html#pause">pause</a></li><li data-type='method'><a href="Tily.Animation.html#reset">reset</a></li><li data-type='method'><a href="Tily.Animation.html#run">run</a></li><li data-type='method'><a href="Tily.Animation.html#update">update</a></li></ul></li><li><a href="Tily.Buffer.html">Buffer</a><ul class='methods'><li data-type='method'><a href="Tily.Buffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Buffer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Buffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.Buffer.html#getData">getData</a></li><li data-type='method'><a href="Tily.Buffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.Buffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.Buffer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.Buffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Buffer.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#resize">resize</a></li><li data-type='method'><a href="Tily.Buffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.Buffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.Buffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.Buffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferBase.html">BufferBase</a><ul class='methods'><li data-type='method'><a href="Tily.BufferBase.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.BufferBase.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.BufferBase.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.BufferBase.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferTransition.html">BufferTransition</a><ul class='methods'><li data-type='method'><a href="Tily.BufferTransition.html#update">update</a></li></ul></li><li><a href="Tily.Cell.html">Cell</a><ul class='methods'><li data-type='method'><a href="Tily.Cell.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Cell.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Cell.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Cell.html#draw">draw</a></li><li data-type='method'><a href="Tily.Cell.html#getData">getData</a></li><li data-type='method'><a href="Tily.Cell.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Cell.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Cell.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Cell.html#serialize">serialize</a></li></ul></li><li><a href="Tily.CellBuffer.html">CellBuffer</a><ul class='methods'><li data-type='method'><a href="Tily.CellBuffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.CellBuffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.CellBuffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.CellBuffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.ForegroundAnimation.html">ForegroundAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ForegroundAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#update">update</a></li></ul></li><li><a href="Tily.Main.html">Main</a><ul class='methods'><li data-type='method'><a href="Tily.Main.html#activateBuffer">activateBuffer</a></li><li data-type='method'><a href="Tily.Main.html#draw">draw</a></li></ul></li><li><a href="Tily.OffsetAnimation.html">OffsetAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#update">update</a></li></ul></li><li><a href="Tily.OffsetTransition.html">OffsetTransition</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetTransition.html#update">update</a></li></ul></li><li><a href="Tily.OpacityAnimation.html">OpacityAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OpacityAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#update">update</a></li></ul></li><li><a href="Tily.OutlineAnimation.html">OutlineAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OutlineAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#update">update</a></li></ul></li><li><a href="Tily.RotationAnimation.html">RotationAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.RotationAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleAnimation.html">ScaleAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleTransition.html">ScaleTransition</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleTransition.html#update">update</a></li></ul></li><li><a href="Tily.ShadowAnimation.html">ShadowAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ShadowAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#update">update</a></li></ul></li><li><a href="Tily.TextAnimation.html">TextAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.TextAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.TextAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.TextAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.TextAnimation.html#update">update</a></li></ul></li><li><a href="Tily.TileLayer.html">TileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.TileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.TileLayer.html#clear">clear</a></li><li data-type='method'><a href="Tily.TileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.TileLayer.html#fill">fill</a></li><li data-type='method'><a href="Tily.TileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.TileLayer.html#getTile">getTile</a></li><li data-type='method'><a href="Tily.TileLayer.html#resize">resize</a></li><li data-type='method'><a href="Tily.TileLayer.html#setTile">setTile</a></li></ul></li><li><a href="Tily.Transition.html">Transition</a><ul class='methods'><li data-type='method'><a href="Tily.Transition.html#update">update</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">activetile.js</h1>
    

    <!--container.tmpl-->




    <!--source.tmpl-->

    <section>
        <article>
            <pre class="prettyprint source linenums"><code>Tily.ActiveTile = (function(_super) {
  "use strict";
  Tily.utility.__extends(ActiveTile, _super);

  /**
   * A tile that can be translated, scaled, rotated and animated.
   * @class
   * @extends Tily.ActiveTileBase
   * @memberof Tily
   * @param {number} [x=0] The initial x-coordinate of this active tile.
   * @param {number} [y=0] The initial y-coordinate of this active tile.
   * @param {number} [zIndex=0] The initial z-index of this active tile.
   */
  function ActiveTile(x, y, zIndex) {
    _super.call(this);

    /**
     * The position of this active tile.
     * @type {Tily.utility.vec2}
     */
    this.position = Tily.utility.vec2(x || 0, y || 0);

    /**
     * The layer ordering of this active tile.
     * @type {number}
     */
    this.zIndex = zIndex || 0;

    /**
     * True if this active tile should clip at the tile edges.
     * @default false
     * @type {boolean}
     */
    this.clip = false;

    /**
     * True if this active tile should wrap around tile edges.
     * @default false
     * @type {boolean}
     */
    this.wrap = false;

    /**
     * True if this active tile should be flipped along the x-axis.
     * @default false
     * @type {boolean}
     */
    this.flip = false;

    /**
     * The font to use when rendering this active tile's layers.
     * @default "sans-serif"
     * @type {string}
     */
    this.font = "sans-serif";

    /**
     * The font style to use when rendering this active tile's layers.
     * @default "normal"
     * @type {string}
     */
    this.fontStyle = "normal";

    /**
     * The font size to use when rendering this active tile's layers. If null, fit characters to the tile.
     * @default null
     * @type {?string}
     */
    this.fontSize = null;

    /**
     * The foreground colour, used for rendering text on this active tile's layers.
     * @default "white"
     * @type {string}
     */
    this.foreground = "white";

    /**
     * The outline width and colour for this active tile's layers.
     * @default null
     * @type {?string}
     */
    this.outline = null;

    /**
     * The shadow amount, offset and colour for this active tile's layers.
     * @default null
     * @type {?string}
     */
    this.shadow = null;

    /**
     * The opacity of this active tile.
     * @default 1
     * @type {number}
     */
    this.opacity = 1;

    /**
     * The composite operation to use when drawing this active tile.
     * @default "source-over"
     * @type {string}
     */
    this.compositeMode = "source-over";

    /**
     * An offset from this active tile's position measured in tiles.
     * @default { x: 0, y: 0 }
     * @type {Tily.utility.vec2}
     */
    this.offset = Tily.utility.vec2();

    /**
     * The scale of this active tile.
     * @default { x: 1, y: 1 }
     * @type {Tily.utility.vec2}
     */
    this.scale = Tily.utility.vec2(1, 1);

    /**
     * The rotation angle of this active tile measured in radians.
     * @default 0
     * @type {number}
     */
    this.rotation = 0;

    /**
     * True if the text in this active tile should be centered.
     * @default false
     * @type {boolean}
     */
    this.centered = false;

    /**
     * True if this active tile should be removed in the next frame.
     * @default false
     * @type {boolean}
     */
    this.destroyed = false;
  }
  /**
   * Animate this active tile's position.
   * @name move
   * @function
   * @instance
   * @memberof Tily.ActiveTile
   * @param {string} direction The movement direction, either 'up', 'down', 'left', 'right'.
   * @param {AnimationOptions} [options] An optional options object.
   */
  ActiveTile.prototype.move = function(direction, options) {
    const directions = {
      up: Tily.utility.vec2(0, -1),
      down: Tily.utility.vec2(0, 1),
      left: Tily.utility.vec2(-1, 0),
      right: Tily.utility.vec2(1, 0)
    };
    this.position = Tily.utility.vec2.add(this.position, directions[direction]);
    const animation = new Tily.OffsetAnimation(this, Tily.utility.vec2.mul(directions[direction], -1), Tily.utility.vec2(), options);
    this.animations.push(animation);
    return new Promise(function(resolve, reject) { animation.finishedCallback = resolve; });
  };

  /**
   * Add an active tile layer to this active tile at the specified z-index. If the z-index is
   * undefined, add the layer on top of existing layers, and if the z-index is -1, add the layer
   * below existing layers.
   * @name addLayer
   * @function
   * @instance
   * @memberof Tily.ActiveTile
   * @param {?Tily.ActiveTileLayer} layer The layer to add. If this is null, a new layer will be created.
   * @param {number} [z] The z-index at which to add the layer. If this is -1, the layer will be
   * added below existing layers and if it is undefined the layer will be added above existing
   * layers.
   * @returns {Tily.ActiveTileLayer} The layer that was added.
   */
  ActiveTile.prototype.addLayer = function(layer, z) {
    // If no layer is specified, create a new one
    layer = layer || new Tily.ActiveTileLayer(this);

    // Make sure the layer has a reference to the top-level active tile
    layer.activeTile = this;

    // Make sure the layer has a reference to its parent (ie. this active tile)
    layer.parent = this;
    return _super.prototype.addLayer.call(this, layer, z);
  };

  /**
   * Draw layers onto the specified context.
   * @param {Tily.ActiveTileLayer[]} layers The layers to draw.
   * @param {CanvasRenderingContext2D} context The context to draw this active tile onto.
   * @param {number} elapsedTime The time elapsed in seconds since the last draw call.
   * @param {number} tileSize The tile size measured in pixels.
   */
  function drawLayers(layers, context, elapsedTime, tileSize) {
    for (let i = 0, length = layers.length; i &lt; length; i++) {
      layers[i].draw(context, elapsedTime, tileSize);
    }
  }

  /**
   * Render this active tile onto the container context.
   * @name draw
   * @function
   * @instance
   * @memberof Tily.ActiveTile
   * @param {CanvasRenderingContext2D} context The context to draw this active tile onto.
   * @param {number} elapsedTime The time elapsed in seconds since the last draw call.
   * @param {number} tileSize The tile size measured in pixels.
   */
  ActiveTile.prototype.draw = function(context, elapsedTime, tileSize) {
    if (!this.layers) { return; }  // Active tile has no layers so don't render
    _super.prototype.draw.call(this, elapsedTime);
    context.save();
    const fontSize = this.fontSize || ((tileSize + 1) + 'px');
    context.font = `${this.fontStyle} ${fontSize} ${this.font}`;
    context.fillStyle = this.foreground;
    context.globalAlpha = this.opacity;
    context.globalCompositeOperation = this.compositeMode;

    // Outline
    if (this.outline) {
      const { width: outlineWidth, colour: outlineColour } = Tily.utility.outline(this.outline);
      context.lineWidth = Math.floor(outlineWidth * tileSize);
      context.strokeStyle = outlineColour;
    }

    // Shadow
    if (this.shadow) {
      const {
        blur: shadowBlur,
        xOffset: shadowXOffset,
        yOffset: shadowYOffset,
        colour: shadowColour
      } = Tily.utility.shadow(this.shadow);
      context.shadowBlur = shadowBlur * tileSize;
      context.shadowOffsetX = Math.floor(shadowXOffset * tileSize);
      context.shadowOffsetY = Math.floor(shadowYOffset * tileSize);
      context.shadowColor = shadowColour;
    }

    // Clip tile boundaries if clipping is enabled
    context.translate(this.position.x * tileSize - 0.5, this.position.y * tileSize - 0.5);
    if (this.clip) {
      context.rect(0, 0, tileSize + 1, tileSize + 1);
      context.clip();
    }
    context.translate((this.offset.x + 0.5) * tileSize, (this.offset.y + 0.5) * tileSize);
    context.rotate(this.rotation);
    context.scale(this.scale.x * (this.flip ? -1 : 1), this.scale.y);
    drawLayers(this.layers, context, elapsedTime, tileSize);

    // If both clipping and wrapping are enabled, re-draw the layers at inverted offsets
    if (this.clip &amp;&amp; this.wrap) {
      const wrapX = tileSize * (this.offset.x > 0 ? -1 : 1) * (this.flip ? -1 : 1),
        wrapY = tileSize * (this.offset.y > 0 ? -1 : 1);
      if (this.offset.x != 0) {
        context.save();
        context.translate(this.offset.x + wrapX, 0);
        drawLayers(this.layers, context, elapsedTime, tileSize);
        context.restore();
      }
      if (this.offset.y != 0) {
        context.save();
        context.translate(0, this.offset.y + wrapY, 0);
        drawLayers(this.layers, context, elapsedTime, tileSize);
        context.restore();
      }
      if (this.offset.x != 0 &amp;&amp; this.offset.y != 0) {
        context.save();
        context.translate(this.offset.x + wrapX, this.offset.y + wrapY);
        drawLayers(this.layers, context, elapsedTime, tileSize);
        context.restore();
      }
    }
    context.restore();
  };

  /**
   * Get serializable data for this active tile.
   * @name getData
   * @function
   * @instance
   * @memberof Tily.ActiveTile
   * @returns {Object} This active tile's data.
   */
  ActiveTile.prototype.getData = function() {
    return {
      layers: this.layers.map(i => i.getData()),
      position: this.position,
      zIndex: this.zIndex,
      clip: this.clip,
      wrap: this.wrap,
      flip: this.flip,
      font: this.font,
      fontStyle: this.fontStyle,
      fontSize: this.fontSize,
      foreground: this.foreground,
      outline: this.outline,
      shadow: this.shadow,
      opacity: this.opacity,
      compositeMode: this.compositeMode,
      offset: this.offset,
      scale: this.scale,
      rotation: this.rotation,
      centered: this.centered
    };
  };

  /**
   * Create an active tile from data.
   * @name fromData
   * @function
   * @static
   * @memberof Tily.ActiveTile
   * @param {Object} data Serialized active tile data.
   * @returns {Tily.ActiveTile} An active tile created from the provided data.
   */
  ActiveTile.fromData = function(data) {
    const tile = new Tily.ActiveTile(data.position.x, data.position.y, data.zIndex);
    tile.layers = data.layers.map(i => Tily.ActiveTileLayer.fromData(tile, tile, i));
    tile.clip = data.clip;
    tile.wrap = data.wrap;
    tile.flip = data.flip;
    tile.font = data.font;
    tile.fontStyle = data.fontStyle;
    tile.fontSize = data.fontSize;
    tile.foreground = data.foreground;
    tile.outline = data.outline;
    tile.shadow = data.shadow;
    tile.opacity = data.opacity;
    tile.compositeMode = data.compositeMode;
    tile.offset = data.offset;
    tile.scale = data.scale;
    tile.rotation = data.rotation;
    tile.centered = data.centered;
    return tile;
  };
  return ActiveTile;
}(Tily.ActiveTileBase));
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Thu Oct 01 2020 16:19:13 GMT+0100 (British Summer Time) using the LOKE theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
