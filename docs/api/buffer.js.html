<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>buffer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="nav">
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-tily-reference.html">Quick Reference</a></li></ul><h3>Namespaces</h3><ul><li><a href="Tily.html">Tily</a></li></ul><h3>Classes</h3><ul><li><a href="Tily.ActiveTile.html">ActiveTile</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTile.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTile.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTile.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTile.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTile.html#move">move</a></li><li data-type='method'><a href="Tily.ActiveTile.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTile.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTile.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTile.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.ActiveTileBase.html">ActiveTileBase</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileBase.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileBase.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.ActiveTileLayer.html">ActiveTileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.ActiveTileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateForeground">animateForeground</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOffset">animateOffset</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOpacity">animateOpacity</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateOutline">animateOutline</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateRotation">animateRotation</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateScale">animateScale</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateShadow">animateShadow</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#animateText">animateText</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#pauseAnimations">pauseAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#resetAnimations">resetAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#runAnimations">runAnimations</a></li><li data-type='method'><a href="Tily.ActiveTileLayer.html#stopAnimations">stopAnimations</a></li></ul></li><li><a href="Tily.Animation.html">Animation</a><ul class='methods'><li data-type='method'><a href="Tily.Animation.html#pause">pause</a></li><li data-type='method'><a href="Tily.Animation.html#reset">reset</a></li><li data-type='method'><a href="Tily.Animation.html#run">run</a></li><li data-type='method'><a href="Tily.Animation.html#update">update</a></li></ul></li><li><a href="Tily.Buffer.html">Buffer</a><ul class='methods'><li data-type='method'><a href="Tily.Buffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Buffer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Buffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.Buffer.html#getData">getData</a></li><li data-type='method'><a href="Tily.Buffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.Buffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.Buffer.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.Buffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.Buffer.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Buffer.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Buffer.html#resize">resize</a></li><li data-type='method'><a href="Tily.Buffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.Buffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.Buffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.Buffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferBase.html">BufferBase</a><ul class='methods'><li data-type='method'><a href="Tily.BufferBase.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.BufferBase.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.BufferBase.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.BufferBase.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.BufferBase.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.BufferBase.html#zoom">zoom</a></li></ul></li><li><a href="Tily.BufferTransition.html">BufferTransition</a><ul class='methods'><li data-type='method'><a href="Tily.BufferTransition.html#update">update</a></li></ul></li><li><a href="Tily.Cell.html">Cell</a><ul class='methods'><li data-type='method'><a href="Tily.Cell.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.Cell.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.Cell.html#addLayer">addLayer</a></li><li data-type='method'><a href="Tily.Cell.html#draw">draw</a></li><li data-type='method'><a href="Tily.Cell.html#getData">getData</a></li><li data-type='method'><a href="Tily.Cell.html#moveLayer">moveLayer</a></li><li data-type='method'><a href="Tily.Cell.html#removeAllLayers">removeAllLayers</a></li><li data-type='method'><a href="Tily.Cell.html#removeLayer">removeLayer</a></li><li data-type='method'><a href="Tily.Cell.html#serialize">serialize</a></li></ul></li><li><a href="Tily.CellBuffer.html">CellBuffer</a><ul class='methods'><li data-type='method'><a href="Tily.CellBuffer.html#.deserialize">deserialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#addActiveTile">addActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#draw">draw</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getPosition">getPosition</a></li><li data-type='method'><a href="Tily.CellBuffer.html#getTileInfo">getTileInfo</a></li><li data-type='method'><a href="Tily.CellBuffer.html#moveOffset">moveOffset</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeActiveTile">removeActiveTile</a></li><li data-type='method'><a href="Tily.CellBuffer.html#removeAllActiveTiles">removeAllActiveTiles</a></li><li data-type='method'><a href="Tily.CellBuffer.html#serialize">serialize</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateActiveTilesMap">updateActiveTilesMap</a></li><li data-type='method'><a href="Tily.CellBuffer.html#updateTransitions">updateTransitions</a></li><li data-type='method'><a href="Tily.CellBuffer.html#zoom">zoom</a></li></ul></li><li><a href="Tily.ForegroundAnimation.html">ForegroundAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ForegroundAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ForegroundAnimation.html#update">update</a></li></ul></li><li><a href="Tily.Main.html">Main</a><ul class='methods'><li data-type='method'><a href="Tily.Main.html#activateBuffer">activateBuffer</a></li><li data-type='method'><a href="Tily.Main.html#draw">draw</a></li></ul></li><li><a href="Tily.OffsetAnimation.html">OffsetAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OffsetAnimation.html#update">update</a></li></ul></li><li><a href="Tily.OffsetTransition.html">OffsetTransition</a><ul class='methods'><li data-type='method'><a href="Tily.OffsetTransition.html#update">update</a></li></ul></li><li><a href="Tily.OpacityAnimation.html">OpacityAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OpacityAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OpacityAnimation.html#update">update</a></li></ul></li><li><a href="Tily.OutlineAnimation.html">OutlineAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.OutlineAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.OutlineAnimation.html#update">update</a></li></ul></li><li><a href="Tily.RotationAnimation.html">RotationAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.RotationAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.RotationAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleAnimation.html">ScaleAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ScaleAnimation.html#update">update</a></li></ul></li><li><a href="Tily.ScaleTransition.html">ScaleTransition</a><ul class='methods'><li data-type='method'><a href="Tily.ScaleTransition.html#update">update</a></li></ul></li><li><a href="Tily.ShadowAnimation.html">ShadowAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.ShadowAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.ShadowAnimation.html#update">update</a></li></ul></li><li><a href="Tily.TextAnimation.html">TextAnimation</a><ul class='methods'><li data-type='method'><a href="Tily.TextAnimation.html#pause">pause</a></li><li data-type='method'><a href="Tily.TextAnimation.html#reset">reset</a></li><li data-type='method'><a href="Tily.TextAnimation.html#run">run</a></li><li data-type='method'><a href="Tily.TextAnimation.html#update">update</a></li></ul></li><li><a href="Tily.TileLayer.html">TileLayer</a><ul class='methods'><li data-type='method'><a href="Tily.TileLayer.html#.fromData">fromData</a></li><li data-type='method'><a href="Tily.TileLayer.html#clear">clear</a></li><li data-type='method'><a href="Tily.TileLayer.html#draw">draw</a></li><li data-type='method'><a href="Tily.TileLayer.html#fill">fill</a></li><li data-type='method'><a href="Tily.TileLayer.html#getData">getData</a></li><li data-type='method'><a href="Tily.TileLayer.html#getTile">getTile</a></li><li data-type='method'><a href="Tily.TileLayer.html#resize">resize</a></li><li data-type='method'><a href="Tily.TileLayer.html#setTile">setTile</a></li></ul></li><li><a href="Tily.Transition.html">Transition</a><ul class='methods'><li data-type='method'><a href="Tily.Transition.html#update">update</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">buffer.js</h1>
    

    <!--container.tmpl-->




    <!--source.tmpl-->

    <section>
        <article>
            <pre class="prettyprint source linenums"><code>Tily.Buffer = (function(_super) {
  "use strict";
  Tily.utility.__extends(Buffer, _super);

  /**
   * A buffer containing tile layers that can be rendered in the Tily canvas.
   * @class
   * @extends Tily.BufferBase
   * @memberof Tily
   * @param {number} width The width of the buffer in tiles.
   * @param {number} height The height of the buffer in tiles.
   * @param {BufferOptions} [options] An optional options object for configuring the buffer.
   */
  function Buffer(width, height, options) {
    _super.call(this, options);

    /**
     * The layers contained in this buffer.
     * @type {Tily.TileLayer[]}
     */
    this.layers = [];
    this.size.width = width;
    this.size.height = height;
  }

  /**
   * Add a layer to this buffer at the specified z-index. If the z-index is undefined, add the
   * layer on top of existing layers, and if the z-index is -1, add the layer below existing
   * layers.
   * @name addLayer
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {?Tily.TileLayer} [layer] The layer to add. If null, add an empty new layer.
   * @param {number} [z] The z-index at which to add the layer. If this is -1, the layer will be
   * added below existing layers and if it is undefined the layer will be added above existing
   * layers.
   * @returns {Tily.TileLayer} The layer that was added.
   */
  Buffer.prototype.addLayer = function(layer, z) {
    // If no layer is specified, create a new one
    layer = layer || new Tily.TileLayer(this);

    // Make sure the layer has a reference to this buffer
    layer.container = this;
    if (z === undefined) {
      this.layers.push(layer);
    } else if (z == -1) {
      this.layers.unshift(layer);
    } else {
      this.layers.splice(z, 0, layer);
    }
    return layer;
  };

  /**
   * Remove a layer at the specified z-index. If the z-index is undefined, remove the top layer
   * and if the z-index is -1, remove the bottom layer. The removed layer is returned.
   * @name removeLayer
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {number} [z] The z-index of the layer to remove. If this is -1, the bottom layer will
   * be removed and if it is undefined the top layer will be removed.
   * @returns {Tily.TileLayer} The layer that was removed.
   */
  Buffer.prototype.removeLayer = function(z) {
    if (this.layers.length &lt; 1) { return null; }
    if (z === undefined) {
      return this.layers.pop();
    } else if (z == -1) {
      return this.layers.shift();
    }
    return this.layers.splice(z, 1)[0];
  };

  /**
   * Remove all layers from this buffer.
   * @name removeAllLayers
   * @function
   * @instance
   * @memberof Tily.Buffer
   */
  Buffer.prototype.removeAllLayers = function() {
    this.layers = [];
  };

  /**
   * Move a layer from one z-index to another z-index, either an absolute value or relative to
   * the layer's current z-index.
   * @name moveLayer
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {number} zFrom The z-index of the layer to move.
   * @param {number} zTo The z-index to move the layer to.
   * @param {boolean} relative If this is true, the layer will be moved relative to it's current
   * z-index.
   * @returns {boolean} True if a layer was moved successfully.
   */
  Buffer.prototype.moveLayer = function(zFrom, zTo, relative) {
    if (this.layers.length &lt; 2) { return false; }
    if (zFrom &lt; 0 || zFrom >= this.layers.length) { return false; }
    const layer = this.layers.splice(zFrom, 1)[0],
      toIndex = Tily.utility.clamp(relative ? zFrom + zTo : zTo, 0, this.layers.length);
    this.layers.splice(toIndex, 0, layer);
    return true;
  };

  /**
   * Resize this buffer's layers.
   * @name resize
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {number} width The new width.
   * @param {number} height The new height.
   */
  Buffer.prototype.resize = function(width, height) {
    for (let i = this.layers.length; i--;) {
      this.layers[i].resize(width, height);
    }
    this.size.width = width;
    this.size.height = height;
  };

  /**
   * @typedef BufferTileInfo
   * @type {BufferBaseTileInfo}
   * @property {string[]} layers The tile layer characters in z-index order at a tile position.
   */
  /**
   * Get information about the tiles and active tiles at a tile position.
   * @name getTileInfo
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {number} x The x-coordinate of the tile position.
   * @param {number} y The y-coordinate of the tile position.
   * @returns {BufferTileInfo} Information about the tiles at the specified position.
   */
  Buffer.prototype.getTileInfo = function(x, y) {
    const tileInfo = _super.prototype.getTileInfo.call(this, x, y);
    tileInfo.layers = this.layers.map(i => i.getTile(x, y));
    return tileInfo;
  };

  /**
   * Render this buffer's layers onto the specified context.
   * @name draw
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @param {CanvasRenderingContext2D} context The context to render the buffer onto.
   * @param {number} elapsedTime The time elapsed in seconds since the last draw call.
   * @param {number} width The width of the canvas in pixels.
   * @param {number} height The height of the canvas in pixels.
   */
  Buffer.prototype.draw = function(context, elapsedTime, width, height) {
    this.canvas.width = width;
    this.canvas.height = height;
    this.context.save();
    // this.context.textBaseline = "top";
    this.context.clearRect(0, 0, width, height);
    var offset = this.updateTransitions(elapsedTime);

    // Clamp camera scale
    var lockedAxis = this.options.lockedAxis,
      maximumScale = this.options.maximumScale;

    // If clamping is enabled, make sure the maximum scale doesn't exceed the smallest buffer
    // dimension (so that there are no empty edges visible)
    if (this.options.clampCamera) {
      maximumScale = Math.min(maximumScale, this.size.width, this.size.height);
      if (width > height) {
        lockedAxis = "x";
      } else if (height > width) {
        lockedAxis = "y";
      }
    }
    this.scale = Tily.utility.clamp(
      this.scale,
      Math.max(this.options.minimumScale, 1),  // Minimum scale cannot go below 1 tile
      maximumScale
    );
    this.tileSize = (lockedAxis == "y" ? height : width) / this.scale;
    this.viewSize.width = width / this.tileSize;
    this.viewSize.height = height / this.tileSize;

    // Clamp camera offset
    if (this.options.clampCamera) {
      const centerX = this.viewSize.width * 0.5 - 0.5,
        centerY = this.viewSize.height * 0.5 - 0.5;
      this.offset = offset = Tily.utility.vec2(
        Tily.utility.clamp(offset.x, centerX, this.size.width - centerX - 1),
        Tily.utility.clamp(offset.y, centerY, this.size.height - centerY - 1)
      );
    }

    // Translate camera viewport
    this.context.translate(
      width * 0.5 - offset.x * this.tileSize - this.tileSize * 0.5,
      height * 0.5 - offset.y * this.tileSize - this.tileSize * 0.5
    );

    // Update active tiles map
    const halfSize = Tily.utility.vec2(this.viewSize.width * 0.5 + 1, this.viewSize.height * 0.5 + 1),
      tl = Tily.utility.vec2.map(Tily.utility.vec2.sub(offset, halfSize), Math.floor),
      br = Tily.utility.vec2.map(Tily.utility.vec2.add(offset, halfSize), Math.ceil),
      activeTiles = this.updateActiveTilesMap(tl, br);

    // Render layers and active tiles in z-order
    var j = 0;
    for (let i = 0, length = this.layers.length; i &lt; length; i++) {
      this.layers[i].draw(this.context, this.tileSize, tl, br);

      // Draw active tiles on or below this layer
      while (j &lt; activeTiles.length &amp;&amp; activeTiles[j].zIndex &lt; i + 1) {
        activeTiles[j].draw(this.context, elapsedTime, this.tileSize);
        j++;
      }
    }

    // Draw any remaining active tiles (ie. on the top layer)
    while (j &lt; activeTiles.length) {
      activeTiles[j].draw(this.context, elapsedTime, this.tileSize);
      j++;
    }
    this.context.restore();
    context.drawImage(this.canvas, 0, 0);
  };

  /**
   * Get serializable data for this buffer.
   * @name getData
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @returns {Object} This buffer's data.
   */
  Buffer.prototype.getData = function() {
    return {
      layers: this.layers.map(i => i.getData()),
      activeTiles: this.activeTiles.map(i => i.getData()),
      options: this.options,
      size: this.size,
      offset: this.offset,
      scale: this.scale
    };
  };

  /**
   * Create a buffer from data.
   * @name fromData
   * @function
   * @static
   * @memberof Tily.Buffer
   * @param {Object} data Serialized buffer data.
   * @returns {Tily.Buffer} A buffer created from the provided data.
   */
  Buffer.fromData = function(data) {
    const buffer = new Tily.Buffer(data.size.width, data.size.height, data.options);
    buffer.size = data.size;
    buffer.offset = data.offset;
    buffer.scale = data.scale;
    buffer.layers = data.layers.map(i => Tily.TileLayer.fromData(buffer, i));
    buffer.activeTiles = data.activeTiles.map(i => Tily.ActiveTile.fromData(i));
    return buffer;
  };

  /**
   * Serialize this buffer and return the serialized JSON data.
   * @name serialize
   * @function
   * @instance
   * @memberof Tily.Buffer
   * @returns {string} This buffer serialized as JSON data.
   */
  Buffer.prototype.serialize = function() {
    return JSON.stringify(this.getData());
  };

  /**
   * Deserialize the JSON data into a buffer.
   * @name deserialize
   * @function
   * @static
   * @memberof Tily.Buffer
   * @param {string} s The JSON data to deserialize.
   * @returns {Tily.Buffer} The deserialized buffer.
   */
  Buffer.deserialize = function(s) {
    var data = null;
    try {
      data = JSON.parse(s);
    } catch (e) {
      console.log("Couldn't deserialize data: %O", e);
      return null;
    }
    return Tily.Buffer.fromData(data);
  };
  return Buffer;
}(Tily.BufferBase));
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Thu Oct 01 2020 15:59:54 GMT+0100 (British Summer Time) using the LOKE theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
